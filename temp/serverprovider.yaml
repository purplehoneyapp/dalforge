# config.yaml
entities:
  user:
    instances:
      reads:
        - server: readserver1.domain
          database: myapp
          credentials:
            user: myapp
            pass: ${USER_DB_PASS}
        - server: readserver2.domain
          database: myapp
          credentials:
            user: myapp
            pass: ${USER_DB_PASS}
      writes:
        - server: writeserver1.domain
          database: myapp
          credentials:
            user: myapp
            pass: ${USER_DB_PASS}

  accounts:
    # We have two shard sets: v1 (old) and v2 (new)
    shardSets:
      - name: v1   # old shards
        shards:
          - name: shardA
            reads:
              - server: shardA-read1.domain
                database: accounts_shardA
                credentials:
                  user: myapp
                  pass: ${SHARD_A_PASS}
            writes:
              - server: shardA-write.domain
                database: accounts_shardA
                credentials:
                  user: myapp
                  pass: ${SHARD_A_PASS}
          - name: shardB
            reads:
              - server: shardB-read1.domain
                database: accounts_shardB
                credentials:
                  user: myapp
                  pass: ${SHARD_B_PASS}
            writes:
              - server: shardB-write.domain
                database: accounts_shardB
                credentials:
                  user: myapp
                  pass: ${SHARD_B_PASS}
      - name: v2   # new shards
        cuttoffid: 103445 # anything after this id will be using this shard set
        shards:
          - name: shard1
            reads:
              - server: new-read1.domain
                database: accounts_shard1
                credentials:
                  user: myapp
                  pass: ${SHARD_1_PASS}
            writes:
              - server: new-write.domain
                database: accounts_shard1
                credentials:
                  user: myapp
                  pass: ${SHARD_1_PASS}
          - name: shard2
            reads:
              - server: new-read2.domain
                database: accounts_shard2
                credentials:
                  user: myapp
                  pass: ${SHARD_2_PASS}
            writes:
              - server: new-write2.domain
                database: accounts_shard2
                credentials:
                  user: myapp
                  pass: ${SHARD_2_PASS}
